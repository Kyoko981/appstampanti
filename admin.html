<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Pannello Admin</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="script.js"></script>
<link rel="stylesheet" href="style.css">

<style>
table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    background: rgba(0,0,30,0.5);
    color: white;
    border-radius: 8px;
}
th, td {
    padding: 10px;
    border-bottom: 1px solid #1a3a57;
}
button {
    background: #c0392b;
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
}
button:hover {
    background: #e74c3c;
}
</style>

</head>
<body>

<div id="snow"></div>

<h1>Gestione Richieste</h1>

<div id="contenuto"></div>

<script>
(async () => {
    const m = localStorage.getItem("matricola");
    if (!isAdmin(m)) {
        document.body.innerHTML = "<h2>â›” Accesso negato</h2>";
        return;
    }

    const { data, error } = await sb
        .from("stampanti_in_attesa")
        .select("*")
        .order("created_at", { ascending: false });

    if (error) {
        document.getElementById("contenuto").innerHTML = "Errore: " + error.message;
        return;
    }

    let html = `
    <table>
        <tr>
            <th>IP</th>
            <th>DNS</th>
            <th>Inserito</th>
            <th>Azioni</th>
        </tr>
    `;

    data.forEach(r => {
        html += `
        <tr>
            <td>${r.ip}</td>
            <td>${r.dns}</td>
            <td>${new Date(r.created_at).toLocaleString()}</td>
            <td><button onclick="eliminaRichiesta('${r.id}')">Elimina</button></td>
        </tr>`;
    });

    html += "</table>";

    document.getElementById("contenuto").innerHTML = html;
})();

</script>

</body>
</html>
