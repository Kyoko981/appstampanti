<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Pannello Admin ðŸŽ…</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="script.js"></script>

</head>
<body>

<div id="snow"></div>

<h1 style="text-align:center; margin-top:30px;">ðŸŽ… Gestione Richieste Stampanti ðŸŽ„</h1>

<div id="contenuto" class="adminBox">
    Caricamentoâ€¦
</div>

<script>
(async () => {

    const m = localStorage.getItem("matricola");
    if (!isAdmin(m)) {
        document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;'>â›” Accesso negato</h2>";
        return;
    }

    const { data, error } = await sb
        .from("stampanti_in_attesa")
        .select("*")
        .order("created_at", { ascending: false });

    if (error) {
        document.getElementById("contenuto").innerText = "Errore: " + error.message;
        return;
    }

    let html = `
    <table>
        <tr>
            <th>IP</th>
            <th>DNS</th>
            <th>Inserito</th>
            <th>Azioni</th>
        </tr>
    `;

    data.forEach(r => {
        html += `
        <tr>
            <td>${r.ip}</td>
            <td>${r.dns}</td>
            <td>${new Date(r.created_at).toLocaleString()}</td>
            <td><button class="red" onclick="eliminaRichiesta('${r.id}')">Elimina</button></td>
        </tr>`;
    });

    html += "</table>";

    document.getElementById("contenuto").innerHTML = html;
})();
</script>

</body>
</html>
