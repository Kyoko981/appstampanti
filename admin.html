<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestione Richieste</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="script.js"></script>

<style>
    body {
        background: #06223A;
        color: white;
        font-family: Arial;
        padding: 20px;
    }

    h1 {
        text-align: center;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #0A2E4D;
        border-radius: 8px;
        overflow: hidden;
    }

    th {
        background: #133B63;
        padding: 12px;
        font-size: 16px;
    }

    td {
        padding: 10px;
        border-top: 1px solid #1A456E;
    }

    button {
        padding: 6px 10px;
        background: #c0392b;
        border: none;
        border-radius: 6px;
        color: white;
        cursor: pointer;
    }

    button:hover {
        background: #e74c3c;
    }

</style>

</head>
<body>

<h1>ðŸ“‹ Gestione Richieste Stampanti</h1>

<div id="contenuto"></div>

<script>
(async () => {
    // Controllo admin
    const m = localStorage.getItem("matricola");
    if (!isAdmin(m)) {
        document.body.innerHTML = "<h2>â›” Accesso negato</h2>";
        return;
    }

    // Carica richieste
    const { data, error } = await sb
        .from("stampanti_in_attesa")
        .select("*")
        .order("created_at", { ascending: false });

    if (error) {
        document.getElementById("contenuto").innerHTML = "Errore: " + error.message;
        return;
    }

    let html = `<table>
        <tr>
            <th>IP</th>
            <th>DNS</th>
            <th>Inserita il</th>
            <th>Azioni</th>
        </tr>
    `;

    data.forEach(r => {
        html += `
            <tr>
                <td>${r.ip}</td>
                <td>${r.dns}</td>
                <td>${new Date(r.created_at).toLocaleString()}</td>
                <td><button onclick="eliminaRichiesta('${r.id}')">Elimina</button></td>
            </tr>
        `;
    });

    html += "</table>";
    document.getElementById("contenuto").innerHTML = html;
})();

async function eliminaRichiesta(id) {
    if (!confirm("Eliminare questa richiesta?")) return;

    const { error } = await sb
        .from("stampanti_in_attesa")
        .delete()
        .eq("id", id);

    if (error) {
        alert("Errore: " + error.message);
        return;
    }

    alert("âœ” Richiesta eliminata!");
    location.reload();
}
</script>

</body>
</html>
